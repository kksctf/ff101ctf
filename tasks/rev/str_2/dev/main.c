// gcc -s -m32 main.c -o bin/str_2

#include <stdio.h>
#include <string.h>

#define SIZE 40
static volatile unsigned char* flg = "ptctf{s0m3t1m3s_fl4g_1s_f4k3_1llusi0n}";
unsigned char flg_real[SIZE]     = {0xc3,0xb5,0x8d,0x01,0x4c,0xe8,0xbc,0x58,0x59,0x8b,0xa9,0x70,0x88,0x1a,0xe3,0x92,0xef,0x92,0xa5,0xb2,0xf5,0xe9,0xca,0x56,0x00,0x8f,0x6a,0xb7,0xa1,0x9c,0x42,0x40,0xc6,0x84,0x93,0x22,0xa3,0xcd,0xf2,0xd8};
unsigned char key[SIZE]          = {0xb3,0xc1,0xee,0x75,0x2a,0x93,0x8d,0x2c,0x2a,0xd4,0xd0,0x40,0xfd,0x68,0xbc,0xf4,0xde,0xe0,0xd6,0xc6,0xaa,0x9b,0xf9,0x62,0x6c,0xd0,0x18,0x84,0xd7,0xaf,0x30,0x33,0xf5,0xdb,0xe7,0x16,0xd0,0xa6,0xcd,0xa5};

__attribute__((constructor))
void decrypt()
{
    for (int i = 0; i < SIZE; i++)
    {
        unsigned char k = key[i];
        unsigned char f = flg_real[i];
        flg_real[i] = f ^ k;
    }
    flg = flg_real;
}

int main(int argc, char** argv)
{
    unsigned char buff[SIZE+1];
    printf("Enter flag: ");
    fgets(buff, SIZE+1, stdin);

    if (strncmp(buff, flg, SIZE)) {
        puts("[-] Flag incorrect.");
    } else {
        puts("[+] Flag correct.");
    }
    return 0;
}  